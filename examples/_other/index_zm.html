<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>elpy.js</title>
</head>
<body>
    <canvas id="field"></canvas>

    <script src="../../dist/elpy.min.js"></script>
    <script>
        const elpy = new Elpy('#field');
        const character = elpy.create('character', 300, 80, 20, 20, { color: 'green' });
        const zombie01 = elpy.create('zombie01', 50, 50, 20, 20, { color: 'red' });
        const zombie02 = elpy.create('zombie02', 50, 80, 20, 20, { color: 'red' });
        const zombie03 = elpy.create('zombie03', 50, 110, 20, 20, { color: 'red' });
        const step = 1;

        let degress01;
        let degress02;
        let degress03;

        elpy.add(character);
        elpy.add(zombie01);
        elpy.add(zombie02);
        elpy.add(zombie03);

        character.collision(zombie01);
        character.collision(zombie02);
        character.collision(zombie03);

        zombie01.collision(character);
        zombie01.collision(zombie02);
        zombie01.collision(zombie03);

        zombie02.collision(character);
        zombie02.collision(zombie01);
        zombie02.collision(zombie03);

        zombie03.collision(character);
        zombie03.collision(zombie01);
        zombie03.collision(zombie02);

        setInterval(() => {
            degress01 = Math.atan2(zombie01.y - character.y, zombie01.x - character.x) * 180 / Math.PI;
            degress02 = Math.atan2(zombie02.y - character.y, zombie02.x - character.x) * 180 / Math.PI;
            degress03 = Math.atan2(zombie03.y - character.y, zombie03.x - character.x) * 180 / Math.PI;

            zombie01.rotate(degress01 + 90);
            zombie01.run(1);

            zombie02.rotate(degress02 + 90);
            zombie02.run(1);

            zombie03.rotate(degress03 + 90);
            zombie03.run(1);
        }, 50);

        zombie01.on('collision', (object, side) => {
            setTimeout(() => {
                if (side === 'top') {
                    zombie01.move(zombie01.x, zombie01.y - step);
                }

                if (side === 'bottom') {
                    zombie01.move(zombie01.x, zombie01.y + step);
                }

                if (side === 'left') {
                    zombie01.move(zombie01.x + step, zombie01.y);
                }

                if (side === 'right') {
                    zombie01.move(zombie01.x - step, zombie01.y);
                }
            }, 100);
        });

        zombie02.on('collision', (object, side) => {
            setTimeout(() => {
                if (side === 'top') {
                    zombie02.move(zombie02.x, zombie02.y - step);
                }

                if (side === 'bottom') {
                    zombie02.move(zombie02.x, zombie02.y + step);
                }

                if (side === 'left') {
                    zombie02.move(zombie02.x + step, zombie02.y);
                }

                if (side === 'right') {
                    zombie02.move(zombie02.x - step, zombie02.y);
                }
            }, 100);
        });

        zombie03.on('collision', (object, side) => {
            setTimeout(() => {
                if (side === 'top') {
                    zombie03.move(zombie03.x, zombie03.y - step);
                }

                if (side === 'bottom') {
                    zombie03.move(zombie03.x, zombie03.y + step);
                }

                if (side === 'left') {
                    zombie03.move(zombie03.x + step, zombie03.y);
                }

                if (side === 'right') {
                    zombie03.move(zombie03.x - step, zombie03.y);
                }
            }, 100);
        });

        elpy.key(key => {
            switch(key) {
                case 'ArrowUp':
                    character.run(1);

                    break;
                case 'ArrowDown':
                    character.run(-1);

                    break;
                case 'ArrowRight':
                    character.rotate(character.degrees + 3);

                    break;
                case 'ArrowLeft':
                character.rotate(character.degrees - 3);

                    break;
            }
        });

        elpy.load();
    </script>
</body>
</html>